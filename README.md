
<!-- README.md is generated from README.Rmd. Please edit that file -->

# hubeau

<!-- badges: start -->

[![License:
MIT](https://img.shields.io/badge/license-MIT-orange.svg)](https://cran.r-project.org/web/licenses/MIT)
[![](https://img.shields.io/badge/lifecycle-experimental-blue.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

‘hubeau’ is an R-package proposing a collection of function to help
retrieve the French national data bank of quantitative withdrawals
(Banque Nationale des Prélèvements quantitatifs en Eau - BNPE) available
on its website <https://hubeau.eaufrance.fr> and on
<https://hubeau.eaufrance.fr/page/api-prelevements-eau>

## Installation

You can install the hubeau R-package from it’s development repository
with:

``` r
install.packages("remotes")
remotes::install_gitlab("in-wop/hubeau", host = "gitlab.irstea.fr")
```

## Loading library

``` r
library(hubeau)
```

## Loading data from the Hub’Eau API

Two functions are available:

-   `get_prelevements_prelevement`: retrieve data about abstraction
    points
-   `get_prelevements_chronique`: retrieve annual volume time series and
    characteristics

The available filters for these functions are detailed in the API
documentation respectively:
<https://hubeau.eaufrance.fr/page/api-prelevements-eau#/prelevements/prelevement>
and
<https://hubeau.eaufrance.fr/page/api-prelevements-eau#/prelevements/chronique>

Examples:

``` r
# Characteristics of surface abstraction points in the Ardennes departement
pp08 <- get_prelevements_prelevement(list(code_departement = "08", code_type_milieu = "CONT"))
str(pp08)
#> tibble [85 x 28] (S3: tbl_df/tbl/data.frame)
#>  $ code_point_prelevement     : chr [1:85] "PTP000000000005792" "PTP000000000005793" "PTP000000000005794" "PTP000000000005795" ...
#>  $ nom_point_prelevement      : chr [1:85] "SARL WIEDENMANN" "ENERPRO BOGNY" "FORCES ENERGIES ELECTRIQUES" "STE EXPL CHUTES HYDRAULIQUES" ...
#>  $ date_exploitation_debut    : chr [1:85] "1900-01-01" "1900-01-01" "1900-01-01" "1900-01-01" ...
#>  $ date_exploitation_fin      : logi [1:85] NA NA NA NA NA NA ...
#>  $ code_type_milieu           : chr [1:85] "CONT" "CONT" "CONT" "CONT" ...
#>  $ libelle_type_milieu        : chr [1:85] "Surface continental" "Surface continental" "Surface continental" "Surface continental" ...
#>  $ code_nature                : chr [1:85] "F" "F" "F" "F" ...
#>  $ libelle_nature             : chr [1:85] "FICTIF" "FICTIF" "FICTIF" "FICTIF" ...
#>  $ lieu_dit                   : logi [1:85] NA NA NA NA NA NA ...
#>  $ commentaire                : logi [1:85] NA NA NA NA NA NA ...
#>  $ code_commune_insee         : chr [1:85] "08083" "08081" "08185" "08302" ...
#>  $ nom_commune                : chr [1:85] "Brévilly" "Bogny-sur-Meuse" "Fumay" "Monthermé" ...
#>  $ code_departement           : chr [1:85] "08" "08" "08" "08" ...
#>  $ libelle_departement        : chr [1:85] "Ardennes" "Ardennes" "Ardennes" "Ardennes" ...
#>  $ code_entite_hydro_cours_eau: logi [1:85] NA NA NA NA NA NA ...
#>  $ uri_entite_hydro_cours_eau : logi [1:85] NA NA NA NA NA NA ...
#>  $ code_entite_hydro_plan_eau : logi [1:85] NA NA NA NA NA NA ...
#>  $ uri_entite_hydro_plan_eau  : logi [1:85] NA NA NA NA NA NA ...
#>  $ code_zone_hydro            : chr [1:85] NA NA NA NA ...
#>  $ uri_zone_hydro             : chr [1:85] NA NA NA NA ...
#>  $ code_mer_ocean             : logi [1:85] NA NA NA NA NA NA ...
#>  $ nappe_accompagnement       : logi [1:85] TRUE TRUE TRUE TRUE TRUE TRUE ...
#>  $ uri_bss_point_eau          : logi [1:85] NA NA NA NA NA NA ...
#>  $ code_ouvrage               : chr [1:85] "OPR0000005780" "OPR0000005781" "OPR0000005782" "OPR0000005783" ...
#>  $ uri_ouvrage                : chr [1:85] "https://id.eaufrance.fr/OuvragePrel/OPR0000005780" "https://id.eaufrance.fr/OuvragePrel/OPR0000005781" "https://id.eaufrance.fr/OuvragePrel/OPR0000005782" "https://id.eaufrance.fr/OuvragePrel/OPR0000005783" ...
#>  $ code_bdlisa                : logi [1:85] NA NA NA NA NA NA ...
#>  $ uri_bdlisa                 : logi [1:85] NA NA NA NA NA NA ...
#>  $ code_bss_point_eau         : logi [1:85] NA NA NA NA NA NA ...

# Time series of annual abstracted volumes for drinking water supply from surface water in the Ardennes departement
# As the parameter "source of the water" (ground, surface...) is not available here, we can use the list of abstraction points previously downloaded as filter:
dfAEP <- get_prelevements_chronique(list(code_ouvrage = paste(pp08$code_ouvrage, collapse = ","),
                            code_usage = "AEP"))
str(dfAEP)
#> tibble [40 x 23] (S3: tbl_df/tbl/data.frame)
#>  $ code_ouvrage                 : chr [1:40] "OPR0000000767" "OPR0000000767" "OPR0000000767" "OPR0000000767" ...
#>  $ annee                        : int [1:40] 2012 2013 2014 2015 2016 2017 2018 2012 2013 2014 ...
#>  $ volume                       : num [1:40] 189938 175878 167035 169552 169694 ...
#>  $ code_usage                   : chr [1:40] "AEP" "AEP" "AEP" "AEP" ...
#>  $ libelle_usage                : chr [1:40] "EAU POTABLE" "EAU POTABLE" "EAU POTABLE" "EAU POTABLE" ...
#>  $ code_statut_volume           : chr [1:40] "1" "1" "1" "1" ...
#>  $ libelle_statut_volume        : chr [1:40] "Contrôlé Niveau 1" "Contrôlé Niveau 1" "Contrôlé Niveau 1" "Contrôlé Niveau 1" ...
#>  $ code_qualification_volume    : chr [1:40] "1" "1" "1" "1" ...
#>  $ libelle_qualification_volume : chr [1:40] "Correcte" "Correcte" "Correcte" "Correcte" ...
#>  $ code_statut_instruction      : chr [1:40] "REA" "REA" "REA" "REA" ...
#>  $ libelle_statut_instruction   : chr [1:40] "Prélèvement réalisé" "Prélèvement réalisé" "Prélèvement réalisé" "Prélèvement réalisé" ...
#>  $ code_mode_obtention_volume   : chr [1:40] "MED" "MED" "MED" "MED" ...
#>  $ libelle_mode_obtention_volume: chr [1:40] "Mesure directe" "Mesure directe" "Mesure directe" "Mesure directe" ...
#>  $ prelevement_ecrasant         : logi [1:40] FALSE FALSE FALSE FALSE FALSE FALSE ...
#>  $ producteur_donnee            : chr [1:40] "AERM" "AERM" "AERM" "AERM" ...
#>  $ longitude                    : num [1:40] 4.83 4.83 4.83 4.83 4.83 ...
#>  $ latitude                     : num [1:40] 50.1 50.1 50.1 50.1 50.1 ...
#>  $ code_commune_insee           : chr [1:40] "08247" "08247" "08247" "08247" ...
#>  $ nom_commune                  : chr [1:40] "Landrichamps" "Landrichamps" "Landrichamps" "Landrichamps" ...
#>  $ code_departement             : chr [1:40] "08" "08" "08" "08" ...
#>  $ libelle_departement          : chr [1:40] "Ardennes" "Ardennes" "Ardennes" "Ardennes" ...
#>  $ nom_ouvrage                  : chr [1:40] "COMMUNE DE GIVET" "COMMUNE DE GIVET" "COMMUNE DE GIVET" "COMMUNE DE GIVET" ...
#>  $ uri_ouvrage                  : chr [1:40] "https://id.eaufrance.fr/OuvragePrel/OPR0000000767" "https://id.eaufrance.fr/OuvragePrel/OPR0000000767" "https://id.eaufrance.fr/OuvragePrel/OPR0000000767" "https://id.eaufrance.fr/OuvragePrel/OPR0000000767" ...
```
